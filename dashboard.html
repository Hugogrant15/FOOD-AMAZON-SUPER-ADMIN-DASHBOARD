<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>360 Organic Foodie - Super-Admin Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="./style.css">

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

  <style>
    
  </style>
</head>
<body>
   <!-- Desktop Navbar (visible on md and up) -->
      <nav class="navbar navbar-expand-md bg-white d-none d-md-flex fixed-top">
        <div class="container-fluid">
          <img src="./images/Foodies logo without Banner 1.png" style="width: 50px; height: 50px" alt="">
          <span class="Navlogo1 d-md-none">360 Organic Foodie</span>

          <div class="collapse navbar-collapse">
            <ul class="navbar-nav me-auto">
              <li class="nav-item">
                <div class="input-group Navborder">
                  <button class="btn btn-outline-secondary border-0" type="button">
                    <i class="fas fa-search"></i>
                  </button>
                  <input type="text" class="form-control border-0" placeholder="Search here...">
                </div>
              </li>
            </ul>

            <form class="d-flex">
              <div class="d-flex align-items-center">
                <button class="text-reset me-3 btnSharp"><i class="fa-solid fa-cart-shopping"></i></button>
                <button class="text-reset me-4 btnSharp position-relative" onclick="toggleNotification(event)">
                  <i class="fas fa-bell"></i>
                  <span id="notificationBadge"
                        class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
                        style="font-size: 0.7rem; display:none;">
                  </span>
                </button>


                <img id="userAvatar" class="me-3 rounded-circle" src="./images/cheerful-curly-man-with-bristle-points-left-wears-casual-clothes-spectacles 1.png" alt="User Avatar" width="40" height="40">
                <span id="userName" class="CustomP-14-400 me-3 text-dark fw-semibold"></span>
              </div>
            </form>
            <!-- notification pop-up  -->
              <div class="col-md-4" id="notificationPopUp">
                  <div class="card p-3" style=" overflow-y: auto;">
                    <h6 class="fw-bold mb-3">See all orders here</h6>
                    <ul class="list-unstyled" id="activityFeed"></ul>
                  </div>
              </div>
          </div>
        </div>
      </nav>

      <!-- Mobile Navbar (visible only on sm) -->
      <nav class="navbar bg-white px-3 d-flex justify-content-between align-items-center d-flex d-sm-flex d-md-none">
        <!-- Left side -->
        <div class="d-flex align-items-center">
          <!-- Hamburger -->
          <button class="btn p-0 me-3" data-bs-toggle="offcanvas" data-bs-target="#sidebarMenu">
            <i class="fa-solid fa-bars fs-4"></i>
          </button>

          <!-- Search -->
           <div class="search-container">
            <button class="btn p-0" id="mobileSearchBtn" aria-label="Open search">
              <i class="fa-solid fa-magnifying-glass fs-5 text-muted"></i>
            </button>

            <input
              type="text"
              id="mobileSearchInput"
              class="mobile-search-input"
              placeholder="Search dashboard..."
              aria-label="Search dashboard"
            />
          </div>

          <!-- <div class="search-container position-relative">
            <button class="btn p-0" id="mobileSearchBtn">
              <i class="fa-solid fa-magnifying-glass fs-5 text-muted"></i>
            </button>
            <input type="text" id="mobileSearchInput" class="form-control form-control-sm position-absolute"
              placeholder="Search..."
              style="width: 0; opacity: 0; transition: all 0.3s ease; left: 40px; top: 0; z-index: 1000;">
          </div> -->
        </div>

        <!-- Right side -->
        <div class="d-flex align-items-center">
          <!-- Bell -->
          <button class="text-reset me-1 btnSharp position-relative" onclick="toggleNotification(event)">
                  <i class="fas fa-bell"></i>
                  <span id="notificationBadge1"
                        class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
                        style="font-size: 0.7rem; display:none;">
                  </span>
                </button>

          <!-- Profile -->
          <img src="./images/cheerful-curly-man-with-bristle-points-left-wears-casual-clothes-spectacles 1.png"
              class="rounded-circle"
              alt="Profile" width="40" height="40">
        </div>
              <div class="col-md-4" id="notificationPopUp1">
                  <div class="card p-3" style=" overflow-y: auto;">
                    <h6 class="fw-bold mb-3">Recent Activities in Your City</h6>
                    <ul class="list-unstyled" id="activityFeed1"></ul>
                  </div>
              </div>
      </nav>

      <!-- Sidebar (offcanvas for mobile) -->
      <div class="offcanvas offcanvas-start sidebar" tabindex="-1" id="sidebarMenu">
        <div class="offcanvas-header">
          <h5 class="offcanvas-title">Menu</h5>
          <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body p-4">
          <ul class="listItem">
            <li><a href="./dashboard.html" class="active" style="text-decoration: none; color: #8D98AF; "><i class="fa-solid fa-house me-3"></i>Dashboard</a></li>
            <li><a href="./orders.html" style="text-decoration: none; color: #8D98AF; "><i class="fa-solid fa-cart-shopping me-3"></i>Orders</a></li>
            <li><a href="./product.html" class="" style="text-decoration: none; color: #8D98AF;"><i class="fa-solid fa-cart-shopping me-3"></i></span><span>Product</span></a></li>
            <li><a href="./categories.html" class="" style="text-decoration: none; color: #8D98AF;"><i class="fa-solid fa-layer-group me-3"></i></span><span>Category</span></a></li>
            <li><a href="./customers.html" style="text-decoration: none; color: #8D98AF; "><i class="fa-solid fa-user me-3"></i>Customers</a></li>
            <li><a href="./distributor.html" style="text-decoration: none; color: #8D98AF; "><i class="fa-solid fa-user me-3"></i>distributors</a></li>
            <li><a href="./" style="text-decoration: none; color: #8D98AF;"><i class="fa-solid fa-file-invoice me-3"></i></span><span>Reports</span></a></li>
            <li><a href="./notifications.html" style="text-decoration: none; color: #8D98AF;"><i class="fa-solid fa-bell me-3"></i></span><span>Notifications</span></a></li>
            <li><a href="" style="text-decoration: none; color: #8D98AF;"><i class="fa-solid fa-receipt fa-beat me-3"></i></span><span>Coupon</span></a></li>
            <hr>
            <li><a href="" style="text-decoration: none; color: #8D98AF;"><i class="fa-solid fa-envelope me-3"></i></span><span>Inbox</span></a></li>
            <li><a href="#" style="text-decoration: none; color: #8D98AF; "><i class="fa-solid fa-gear me-3"></i>Settings</a></li>
            <li><a  onclick="logOut()" style="cursor:pointer; text-decoration: none; color: #8D98AF"><i class="fa-solid fa-arrow-right-from-bracket me-3"></i>Logout</a></li>
          </ul>
        </div>
      </div>


      <div class="container-fluid ">
        <div class="row">
          <!-- Sidebar -->
          <!-- <div class="col-md-2 sidebar d-lg-block d-none" >
          <ul class="listItem ">
                  <li">
                  <a href="./dashboard.html" class="active" style="text-decoration: none; color: #8D98AF; "><i class="fa-solid fa-house me-3"></i></span><span>Dashboard</span></a>
                  </li>
                  
                  <li>
                    <a href="./orders.html" class="" style="text-decoration: none; color: #8D98AF;"><i class="fa-solid fa-cart-shopping me-3"></i></span><span>Order</span></a>
                    </li>
                  <li>
                  <li>
                    <a href="./product.html" class="" style="text-decoration: none; color: #8D98AF;"><i class="fa-solid fa-cart-shopping me-3"></i></span><span>Product</span></a>
                    </li>
                  <li>
                  <li>
                    <a href="./categories.html" class="" style="text-decoration: none; color: #8D98AF;"><i class="fa-solid fa-layer-group me-3"></i></span><span>Category</span></a>
                    </li>
                  <li>
                  <a href="./customers.html" style="text-decoration: none; color:#8D98AF;"><i class="fa-solid fa-user me-3"></i></span><span>Customers</span></a>
                  </li>
                  <li>
                  <a href="./distributor.html" style="text-decoration: none; color:#8D98AF;"><i class="fa-solid fa-truck-fast me-2"></i></span><span>Distributors</span></a>
                  </li>
                  <li>
                      <a href="./inventory.html" style="text-decoration: none; color: #8D98AF;"><i class="fa-solid fa-file-invoice me-3"></i></span><span>Reports</span></a>
                  </li>
                  <li>
                      <a href="" style="text-decoration: none; color: #8D98AF;"><i class="fa-solid fa-receipt fa-beat me-3"></i></span><span>Coupon</span></a>
                  </li>
                  <hr>
                  <li class="">
                      <a href="" style="text-decoration: none; color: #8D98AF;"><i class="fa-solid fa-envelope me-3"></i></span><span>Inbox</span></a>
                  </li>
                  <li class="">
                      <a href="" style="text-decoration: none; color: #8D98AF;" ><i class="fa-solid fa-gear me-3"></i></span><span>settings</span></a>
                  </li>
                  

                  <button class="Dashbutton mt-5 " style="cursor: pointer; " onclick="logOut()">
                  <a  style="text-decoration: none; color:#8D98AF ;  "><i class="fa-solid fa-arrow-right-from-bracket me-3"></i></span><span class="logspan">Logout</span></a>
                  </button>
                  </li>
            </ul>
          </div> -->

            <!-- Sidebar -->
         <div class="col-md-2 sidebar d-md-block d-none">
          <ul class="listItem">
            <li>
              <a href="dashboard.html" class="nav-link">
                <i class="fa-solid fa-house me-lg-3 me-md-1"></i>
                <span>Dashboard</span>
              </a>
            </li>
            <li>
              <a href="orders.html" class="nav-link">
                <i class="fa-solid fa-cart-shopping me-lg-3 me-md-1"></i>
                <span>Orders</span>
              </a>
            </li>
            <li>
              <a href="product.html" class="nav-link">
                <i class="fa-solid fa-cart-shopping me-lg-3 me-md-1"></i>
                <span>Products</span>
              </a>
            </li>
            <li>
              <a href="categories.html" class="nav-link">
                <i class="fa-solid fa-layer-group me-lg-3 me-md-1"></i>
                <span>Category</span>
              </a>
            </li>
            <li>
              <a href="./customers.html" class="nav-link">
                <i class="fa-solid fa-user me-lg-3 me-md-1"></i>
                <span>Customer</span>
              </a>
            </li>
            <li>
              <a href="distributor.html" class="nav-link">
                <i class="fa-solid fa-truck-fast me-lg-3 me-md-1"></i>
                <span>Distributors</span>
              </a>
            </li>
            <li>
              <a href="" class="nav-link">
                <i class="fa-solid fa-file-invoice me-lg-3 me-md-1"></i>
                <span>Reports</span>
              </a>
            </li>
            <li>
              <a href="./notifications.html" class="nav-link">
                <i class="fa-solid fa-bell me-lg-3 me-md-1"></i>
                <span>Notifications</span>
              </a>
            </li>
            <li>
              <a href="" class="nav-link">
                <i class="fa-solid fa-receipt fa-beat me-lg-3 me-md-1"></i>
                <span>Coupons</span>
              </a>
            </li>
            <hr>
            <li>
              <a href="#" class="nav-link">
                <i class="fa-solid fa-envelope me-lg-3 me-md-1"></i>
                <span>Inbox</span>
              </a>
            </li>
            <li>
              <a href="#" class="nav-link">
                <i class="fa-solid fa-gear me-lg-3 me-md-1"></i>
                <span>Settings</span>
              </a>
            </li>
            <!-- <li class="mt-5">
              <a href="#" class="nav-link  Dashbutton" onclick="logOut(event)">
                <i class="fa-solid fa-arrow-right-from-bracket me-lg-3 me-md-1"></i>
                <span>Logout</span>
              </a>
            </li> -->
            <button class="Dashbutton mt-5 " style="cursor: pointer; " onclick="logOut()">
            <a  style="text-decoration: none; color:#8D98AF ;  "><i class="fa-solid fa-arrow-right-from-bracket me-3"></i></span><span class="logspan">Logout</span></a>
            </button>
          </ul>
        </div>




          <!-- Main Content -->
          <div class="col-md-10 p-4">

            <!-- <div class="row g-3 mb-4" id="superAdminMetrics">
  <div class="col-md-3">
    <div class="metric-card">
      <h5>Total Revenue</h5>
      <h3 id="totalRevenue">₦0</h3>
      <small id="revenueChange" class="text-success">+0%</small>
      <canvas id="revenueChart" height="40"></canvas>
    </div>
  </div>

  <div class="col-md-3">
    <div class="metric-card">
      <h5>Total Orders</h5>
      <h3 id="totalOrders">0</h3>
      <small id="ordersChange" class="text-success">+0%</small>
      <canvas id="ordersChart" height="40"></canvas>
    </div>
  </div>

  <div class="col-md-3">
    <div class="metric-card">
      <h5>Unique Visits</h5>
      <h3 id="uniqueVisits">0</h3>
      <small id="visitsChange" class="text-danger">-0%</small>
      <canvas id="visitsChart" height="40"></canvas>
    </div>
  </div>

  <div class="col-md-3">
    <div class="metric-card">
      <h5>New Users</h5>
      <h3 id="newUsers">0</h3>
      <small id="newUsersChange" class="text-success">+0%</small>
      <canvas id="newUsersChart" height="40"></canvas>
    </div>
  </div>

  <div class="col-md-3">
    <div class="metric-card">
      <h5>Existing Users</h5>
      <h3 id="existingUsers">0</h3>
      <small id="existingUsersChange" class="text-success">+0%</small>
      <canvas id="existingUsersChart" height="40"></canvas>
    </div>
  </div>
            </div> -->

            <!-- <script>
const endpoints = {
  orders: "http://localhost:3001/amazon/document/api/orders",
  users: "http://localhost:3001/amazon/document/api/users",
  visits: "http://localhost:3001/amazon/document/api/analytics/visits" // optional
};

function last7Days() {
  const dates = [];
  const d = new Date();
  for (let i = 6; i >= 0; i--) {
    const day = new Date(d);
    day.setDate(d.getDate() - i);
    dates.push(day.toISOString().split("T")[0]);
  }
  return dates;
}

function percentChange(current, prev) {
  if (prev === 0) return current > 0 ? 100 : 0;
  return ((current - prev) / prev * 100).toFixed(1);
}

async function loadMetrics() {
  try {
    const [ordersRes, usersRes, visitsRes] = await Promise.all([
      fetch(endpoints.orders).then(r => r.json()),
      fetch(endpoints.users).then(r => r.json()),
      fetch(endpoints.visits).then(r => r.ok ? r.json() : [])
    ]);

    const orders = Array.isArray(ordersRes) ? ordersRes : [];
    const users = Array.isArray(usersRes) ? usersRes : [];
    const visits = Array.isArray(visitsRes) ? visitsRes : [];

    const dates = last7Days();

    // --- Revenue & Orders trend ---
    const revenueMap = Object.fromEntries(dates.map(d => [d, 0]));
    const ordersMap = Object.fromEntries(dates.map(d => [d, 0]));
    orders.forEach(o => {
      const date = new Date(o.createdAt).toISOString().split("T")[0];
      if (revenueMap[date] !== undefined) {
        if (o.paymentStatus === "paid") revenueMap[date] += o.totalAmount || 0;
        ordersMap[date] += 1;
      }
    });
    const revenueTrend = dates.map(d => revenueMap[d]);
    const ordersTrend = dates.map(d => ordersMap[d]);

    const totalRevenue = revenueTrend.reduce((a,b)=>a+b,0);
    const totalOrders = ordersTrend.reduce((a,b)=>a+b,0);

    const revenueChange = percentChange(revenueTrend.at(-1), revenueTrend.at(-2));
    const ordersChange = percentChange(ordersTrend.at(-1), ordersTrend.at(-2));

    // --- Visits trend ---
    const visitsMap = Object.fromEntries(dates.map(d => [d, 0]));
    visits.forEach(v => { if (visitsMap[v.date]) visitsMap[v.date] = v.visits; });
    const visitsTrend = visits.length ? dates.map(d => visitsMap[d]) : ordersTrend; // fallback
    const uniqueVisits = visitsTrend.reduce((a,b)=>a+b,0);
    const visitsChange = percentChange(visitsTrend.at(-1), visitsTrend.at(-2));

    // --- Users trend ---
    const newUsersMap = Object.fromEntries(dates.map(d => [d, 0]));
    users.forEach(u => {
      const date = new Date(u.createdAt).toISOString().split("T")[0];
      if (newUsersMap[date] !== undefined) newUsersMap[date] += 1;
    });
    const newUsersTrend = dates.map(d => newUsersMap[d]);
    const newUsers = newUsersTrend.reduce((a,b)=>a+b,0);
    const newUsersChange = percentChange(newUsersTrend.at(-1), newUsersTrend.at(-2));
    const existingUsers = users.length;

    // --- Update DOM ---
    document.getElementById("totalRevenue").innerText = "₦" + totalRevenue.toLocaleString();
    document.getElementById("revenueChange").innerText = `${revenueChange}%`;

    document.getElementById("totalOrders").innerText = totalOrders;
    document.getElementById("ordersChange").innerText = `${ordersChange}%`;

    document.getElementById("uniqueVisits").innerText = uniqueVisits;
    document.getElementById("visitsChange").innerText = `${visitsChange}%`;

    document.getElementById("newUsers").innerText = newUsers;
    document.getElementById("newUsersChange").innerText = `${newUsersChange}%`;

    document.getElementById("existingUsers").innerText = existingUsers;
    document.getElementById("existingUsersChange").innerText = "0%";

    // --- Charts ---
    drawSparkline("revenueChart", dates, revenueTrend, "#10b981");
    drawSparkline("ordersChart", dates, ordersTrend, "#3b82f6");
    drawSparkline("visitsChart", dates, visitsTrend, "#f59e0b");
    drawSparkline("newUsersChart", dates, newUsersTrend, "#22c55e");
    drawSparkline("existingUsersChart", dates, newUsersTrend, "#6366f1");

  } catch (err) {
    console.error("Error loading metrics:", err);
  }
}

function drawSparkline(id, labels, data, color) {
  const ctx = document.getElementById(id).getContext("2d");
  if (ctx.chart) ctx.chart.destroy();
  ctx.chart = new Chart(ctx, {
    type: "line",
    data: {
      labels,
      datasets: [{ data, borderColor: color, tension: 0.4, fill: false, pointRadius: 0, borderWidth: 2 }]
    },
    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } }
  });
}

document.addEventListener("DOMContentLoaded", () => {
  loadMetrics();
  setInterval(loadMetrics, 30000); // refresh every 30s
});
</script> -->

            <!-- Top Metrics -->
            <div class="row g-3 mb-4" >
              <div class="col-md-3">
                <div class="metric-card">
                <h5>Total Sales (Yearly)</h5>
                <h3 id="totalSales">₦0</h3>
                <small class="text-success">+0% vs last year</small>
              </div>
              </div>
              <div class="col-md-3">
                <div class="metric-card">
                <h5>Total Sales (Daily)</h5>
                <h3 id="totalSalesDaily">₦0</h3>
                <small class="text-success">+0% vs yesterday</small>
              </div>
              </div>
              <div class="col-md-3">
                <div class="metric-card">
                <h5>Total Sales (Weekly)</h5>
                <h3 id="totalSalesWeekly">₦0</h3>
                <small class="text-weekly">+0% vs last week</small>
              </div>
              </div>
              <div class="col-md-3">
                <div class="metric-card">
                  <h5>Total Sales (Monthly)</h5>
                  <h3 id="totalSalesMonthly">₦0</h3>
                  <small class="text-monthly">+0% vs last month</small>
                </div>
              </div>
              </div>
            

            <!-- Charts -->
            <div class="row g-3 mb-4">
              <div class="col-md-8">
               <div class="">
                <div class="card shadow-sm">
                  <div class="card-body">
                    <div class="d-flex flex-wrap justify-content-between align-items-center mb-2">
                      <h5 class="fw-semibold mb-2 mb-sm-0">Orders Over Time </h5>

                      <div class="d-flex align-items-center gap-2">
                        <select id="monthSelect" class="form-select form-select-sm" style="width: 180px;">
                          <option value="">Current Month</option>
                        </select>

                        <div class="form-check form-switch ms-2">
                          <input class="form-check-input" type="checkbox" id="compareToggle">
                          <label class="form-check-label small" for="compareToggle">Compare prev. month</label>
                        </div>
                      </div>
                    </div>

                    <canvas id="ordersOverTimeChart" height="130"></canvas>

                    <div class="mt-3 text-end text-muted small" id="monthlySummary"></div>
                  </div>
                </div>
              </div>
              </div>
              <div class="col-md-4">
                <div class="card shadow-sm p-4">
                  <h6 class="fw-bold mb-4">Last 7 Days Sales</h6>

                  <div class="d-flex flex-column align-items-start">
                    <h4 id="itemsSold" class="fw-bold mb-0">0</h4>
                    <p class="text-muted small mb-2">Items Sold</p>
                    <h4 id="revenue" class="fw-bold mb-0">₦0</h4>
                    <p class="text-muted small mb-3">Revenue</p>
                  </div>

                  <canvas id="salesBarChart" height="250"></canvas>
              </div>
              </div>
            </div>

            <!-- Best Selling Products + Doughnut -->
            
            <div class="row g-3 mb-4">
              <div class="col-md-6">
                <div class="card p-3 h-100">
                  <div class="d-flex align-items-center justify-content-between mb-2">
                    <h6 class="fw-bold">Recent Transactions</h6>
                  </div>
                  <div class="table-responsive">
                    <table class="table align-middle mb-0">
                      <thead>
                        <tr style="color: #8D98AF;">
                          <th>Date</th>
                          <th>Name</th>
                          <th>Amount</th>
                          <th>Status</th>
                        </tr>
                      </thead>
                      <tbody id="recentTransactions">
                        <!-- Latest 5 orders will be inserted here dynamically -->
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            
              <div class="col-md-6">
                <div class="card p-3">
                  <h6>Top Products by Units Sold</h6>
                  <div class="table-responsive">
                    <table class="table align-middle">
                      <thead style="color:#8D98AF;">
                        <tr>
                          <th>Name</th>
                          <th>Price</th>
                          <th>Units Sold</th>
                        </tr>
                      </thead>
                      <tbody id="topProductsBody">
                        <!-- JS will inject rows here -->
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
              
            </div>

            </div>

          

          </div>
      </div>
      



      <!-- DISPLAY DAILY, WEEKLY, MONTHLY, YEARLY SALES WITH % COMPARISON -->
      <script>
        async function loadSuperAdminSales() {
          try {
            const response = await fetch("http://localhost:3001/amazon/document/api/orders");
            if (!response.ok) throw new Error("Failed to fetch orders");
            const orders = await response.json();

            const today = new Date();
            const currentYear = today.getFullYear();
            const currentMonth = today.getMonth();

            const yesterday = new Date(today);
            yesterday.setDate(today.getDate() - 1);

            const lastMonth = currentMonth === 0 ? 11 : currentMonth - 1;
            const lastMonthYear = currentMonth === 0 ? currentYear - 1 : currentYear;

            // Week ranges
            const thisWeekStart = new Date(today);
            thisWeekStart.setDate(today.getDate() - today.getDay() + 1);
            const lastWeekStart = new Date(thisWeekStart);
            lastWeekStart.setDate(thisWeekStart.getDate() - 7);
            const lastWeekEnd = new Date(thisWeekStart);
            lastWeekEnd.setDate(thisWeekStart.getDate() - 1);

            // Helper: filter orders
            const filterOrders = (conditionFn) => 
              orders.filter(o => o.paymentStatus === "paid" && conditionFn(new Date(o.createdAt)));

            // Yearly
            const thisYearOrders = filterOrders(d => d.getFullYear() === currentYear);
            const lastYearOrders = filterOrders(d => d.getFullYear() === currentYear - 1);
            const yearlyTotal = thisYearOrders.reduce((s, o) => s + o.totalAmount, 0);
            const lastYearTotal = lastYearOrders.reduce((s, o) => s + o.totalAmount, 0);
            updateMetric("totalSales", yearlyTotal, lastYearTotal, "year");

            // Daily
            const todayStr = today.toISOString().split("T")[0];
            const yesterdayStr = yesterday.toISOString().split("T")[0];
            const todayOrders = filterOrders(d => d.toISOString().split("T")[0] === todayStr);
            const yesterdayOrders = filterOrders(d => d.toISOString().split("T")[0] === yesterdayStr);
            const dailyTotal = todayOrders.reduce((s, o) => s + o.totalAmount, 0);
            const yesterdayTotal = yesterdayOrders.reduce((s, o) => s + o.totalAmount, 0);
            updateMetric("totalSalesDaily", dailyTotal, yesterdayTotal, "yesterday");

            // Weekly
            const thisWeekOrders = filterOrders(d => d >= thisWeekStart && d <= today);
            const lastWeekOrders = filterOrders(d => d >= lastWeekStart && d <= lastWeekEnd);
            const weeklyTotal = thisWeekOrders.reduce((s, o) => s + o.totalAmount, 0);
            const lastWeekTotal = lastWeekOrders.reduce((s, o) => s + o.totalAmount, 0);
            updateMetric("totalSalesWeekly", weeklyTotal, lastWeekTotal, "last week");

            // Monthly
            const thisMonthOrders = filterOrders(d => d.getMonth() === currentMonth && d.getFullYear() === currentYear);
            const lastMonthOrders = filterOrders(d => d.getMonth() === lastMonth && d.getFullYear() === lastMonthYear);
            const monthlyTotal = thisMonthOrders.reduce((s, o) => s + o.totalAmount, 0);
            const lastMonthTotal = lastMonthOrders.reduce((s, o) => s + o.totalAmount, 0);
            updateMetric("totalSalesMonthly", monthlyTotal, lastMonthTotal, "last month");

          } catch (error) {
            console.error(":fire: Error loading super admin sales:", error);
          }
        }

        // ✅ Update metric with animation + % comparison
        function updateMetric(id, current, previous, label) {
          const elem = document.getElementById(id);
          if (elem) animateNumber(elem, current);

          const percentElem = elem?.nextElementSibling;
          if (percentElem) {
            let percentChange = 0;
            if (previous === 0) {
              percentChange = current > 0 ? 100 : 0;
            } else {
              percentChange = ((current - previous) / previous) * 100;
            }
            const sign = percentChange >= 0 ? "+" : "";
            percentElem.textContent = `${sign}${percentChange.toFixed(1)}% vs ${label}`;
            percentElem.style.color = percentChange >= 0 ? "green" : "red";
          }
        }

        // ✅ Animate number
        function animateNumber(element, targetValue, duration = 1500) {
          const startValue = 0;
          const startTime = performance.now();
          function update(currentTime) {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            const currentNumber = Math.floor(progress * targetValue);
            element.textContent = `₦${currentNumber.toLocaleString("en-NG")}`;
            if (progress < 1) requestAnimationFrame(update);
          }
          requestAnimationFrame(update);
        }

        // Run
        document.addEventListener("DOMContentLoaded", () => {
          if (localStorage.getItem("role") === "super_admin") {
            loadSuperAdminSales();
          }
        });
      </script>

      <!-- LOAD RECENT TRANSACTION ON DASHBOARD  -->
     <script>
    async function loadRecentTransactions() {
      try {
        const res = await fetch("http://localhost:3001/amazon/document/api/orders");
        const orders = await res.json();

        const tbody = document.getElementById("recentTransactions");
        tbody.innerHTML = "";

        if (!orders.length) {
          tbody.innerHTML = `<tr><td colspan="4" class="text-center">No transactions found</td></tr>`;
          return;
        }

        // Sort by newest and take latest 5
        const latestOrders = orders
          .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
          .slice(0, 5);

        latestOrders.forEach(order => {
          // Format name as First L.
          const first = order.customerSnapshot?.firstName || "";
          const last = order.customerSnapshot?.lastName || "";
          const displayName = last ? `${first} ${last[0]}.` : first || "Unknown";

          const date = new Date(order.createdAt).toLocaleDateString("en-GB"); // DD/MM/YYYY
          const amount = `₦${order.totalAmount.toLocaleString()}`;

          // Decide status: use paymentStatus as the key indicator
          let badgeClass = "";
          if (order.paymentStatus?.toLowerCase() === "paid") {
            badgeClass = "badge bg-success-subtle text-success";
          } else if (order.paymentStatus?.toLowerCase() === "pending") {
            badgeClass = "badge bg-secondary-subtle text-secondary";
          } else {
            badgeClass = "badge bg-danger-subtle text-danger";
          }

          const row = `
            <tr>
              <td>${date}</td>
              <td>${displayName}</td>
              <td>${amount}</td>
              <td><span class="${badgeClass}">${order.paymentStatus}</span></td>
            </tr>
          `;

          tbody.insertAdjacentHTML("beforeend", row);
        });
      } catch (err) {
        console.error("Error loading recent transactions:", err);
      }
    }

    // Load on page start
    loadRecentTransactions();
    </script> 

      <!-- PREFIL SUPERADMIN NAME ON DASHBOARD  -->
    <script>
  document.addEventListener("DOMContentLoaded", () => {
    const distributorName = localStorage.getItem("name") || "Distributor";
    document.getElementById("userName").textContent = distributorName;
  });
    </script>

   
  

    











      <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/js/all.min.js" integrity="sha512-b+nQTCdtTBIRIbraqNEwsjB6UvL3UEMkXnhzd8awtCYh0Kcsjl9uEgwVFVbhoj3uu1DO1ZMacNvLoyJJiNfcvg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
      <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
      <script src="./js/index.js"></script>
</body>
</html>
