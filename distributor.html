<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="./style.css">

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <!-- Desktop Navbar (visible on md and up) -->
      <nav class="navbar navbar-expand-lg bg-white d-none d-md-flex fixed-top">
        <div class="container-fluid">
          <img src="./images/Foodies logo without Banner 1.png" style="width: 50px; height: 50px" alt="">
          <span class="Navlogo1">360 Organic Foodie</span>

          <div class="collapse navbar-collapse">
            <ul class="navbar-nav me-auto">
              <li class="nav-item">
                <div class="input-group Navborder">
                  <button class="btn btn-outline-secondary border-0" type="button">
                    <i class="fas fa-search"></i>
                  </button>
                  <input type="text" class="form-control border-0" placeholder="Search here...">
                </div>
              </li>
            </ul>

            <form class="d-flex">
              <div class="d-flex align-items-center">
                <button class="text-reset me-3 btnSharp"><i class="fa-solid fa-cart-shopping"></i></button>
                <button class="text-reset me-4 btnSharp" onclick="toggleNotification(event)">
                  <i class="fas fa-bell"></i>
                </button>
                <img class="me-3 rounded-circle" src="./images/cheerful-curly-man-with-bristle-points-left-wears-casual-clothes-spectacles 1.png" alt="" width="40" height="40">
                <span class="CustomP-14-400 me-3 text-dark fw-semibold">Michael Owen</span>
              </div>
            </form>
            <!-- notification pop-up  -->
                  <div class="col-md-4" id="notificationPopUp">
                      <div class="card p-3">
                        <div class="d-flex align-items-center justify-content-between mb-2 ">
                            <h6>New Customers</h6>
                            <i class="fa-solid fa-ellipsis" style="color: #cbd3e1;"></i>
                        </div>
                        <hr>
                        <!-- first customer -->
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-center">
                                <img src="./images/New Customers List.png" alt="">
                                <div class="ms-3">
                                    <small>Domenica @domenica</small><br>
                                    <small>Comment on Smiles Product</small>
                                </div>
                                
                            </div>
                            <small>1h</small>
                        </div>
                        <!-- second customer -->
                        <div class="d-flex align-items-center justify-content-between mt-3">
                            <div class="d-flex align-items-center">
                                <img src="./images/New Customers List (1).png" alt="">
                                <div class="ms-3">
                                    <small>Mahfuzul @mahfuzul</small><br>
                                    Repled to your comment on reforest..</small>
                                </div>
                                
                            </div>
                            <small>1d</small>
                            <!-- <i class="fa-solid fa-ellipsis" style="color: #cbd3e1;"></i> -->
                        </div>

                        <!-- third customer  -->
                        <div class="d-flex align-items-center justify-content-between mt-3">
                            <div class="d-flex align-items-center">
                                <img src="./images/New Customers List (2).png" alt="">
                                <div class="ms-3">
                                    <small>Laurel @laurel</small><br>
                                    <small>Purchased a Smiles Product</small>
                                </div>
                                
                            </div>
                            <small>2d</small>
                        </div>
                        <!-- fourth customer -->
                        <div class="d-flex align-items-center justify-content-between mt-3">
                            <div class="d-flex align-items-center">
                                <img src="./images/happy-smiling-handsome-man-against-blue-background.png" alt="">
                                <div class="ms-3">
                                    <small>Rosina @rosina</small><br>
                                    <small>Just made a purchase of 5 Coconut<br> Crunches Bites.</small>
                                </div>
                            </div>
                            <small>4h</small>
                        </div>
                        <!-- fifth customer -->
                        <div class="d-flex align-items-center justify-content-between mt-3">
                            <div class="d-flex align-items-center">
                                <img src="./images/New Customers List.png" alt="">
                                <div class="ms-3">
                                    <small>Domenica @domenica</small><br>
                                    <small>Comment on Smiles Product</small>
                                </div>
                                
                            </div>
                            <small>1h</small>
                        </div>
                        <div class="d-flex align-items-center justify-content-between mt-3">
                            <div class="d-flex align-items-center">
                                <img src="./images/New Customers List.png" alt="">
                                <div class="ms-3">
                                    <small>Domenica @domenica</small><br>
                                    <small>Comment on Smiles Product</small>
                                </div>
                                
                            </div>
                            <small>1h</small>
                        </div>
                        <div class="d-flex align-items-center justify-content-between mt-3">
                            <div class="d-flex align-items-center">
                                <img src="./images/New Customers List.png" alt="">
                                <div class="ms-3">
                                    <small>Domenica @domenica</small><br>
                                    <small>Comment on Smiles Product</small>
                                </div>
                                
                            </div>
                            <small>1h</small>
                        </div>
                        <div class="d-flex align-items-center justify-content-between mt-3">
                            <div class="d-flex align-items-center">
                                <img src="./images/New Customers List.png" alt="">
                                <div class="ms-3">
                                    <small>Domenica @domenica</small><br>
                                    <small>Comment on Smiles Product</small>
                                </div>
                                
                            </div>
                            <small>1h</small>
                        </div>
                      </div>
                    </div>
          </div>
        </div>
      </nav>

      <!-- Mobile Navbar (visible only on sm) -->
      <nav class="navbar bg-white px-3 d-flex justify-content-between align-items-center d-flex d-md-none">
        <!-- Left side -->
        <div class="d-flex align-items-center">
          <!-- Hamburger -->
          <button class="btn p-0 me-3" data-bs-toggle="offcanvas" data-bs-target="#sidebarMenu">
            <i class="fa-solid fa-bars fs-4"></i>
          </button>

          <!-- Search -->
          <button class="btn p-0">
            <i class="fa-solid fa-magnifying-glass fs-5 text-muted"></i>
          </button>
        </div>

        <!-- Right side -->
        <div class="d-flex align-items-center">
          <!-- Bell -->
          <button class="btn p-0 me-3 position-relative">
            <i class="fa-regular fa-bell fs-4 text-muted"></i>
            <span class="position-absolute top-0 start-100 translate-middle p-1 bg-success border border-light rounded-circle"></span>
          </button>

          <!-- Profile -->
          <img src="./images/cheerful-curly-man-with-bristle-points-left-wears-casual-clothes-spectacles 1.png"
              class="rounded-circle"
              alt="Profile" width="40" height="40">
        </div>
      </nav>

      <!-- Sidebar (offcanvas for mobile) -->
      <div class="offcanvas offcanvas-start sidebar" tabindex="-1" id="sidebarMenu">
        <div class="offcanvas-header">
          <h5 class="offcanvas-title">Menu</h5>
          <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body p-0">
          <ul class="listItem">
            <li><a href="./dashboard.html" class="active" style="text-decoration: none; color: #8D98AF; "><i class="fa-solid fa-house me-3"></i>Dashboard</a></li>
            <li><a href="./orders.html" style="text-decoration: none; color: #8D98AF; "><i class="fa-solid fa-cart-shopping me-3"></i>Orders</a></li>
            <li><a href="./product.html" class="" style="text-decoration: none; color: #8D98AF;"><i class="fa-solid fa-cart-shopping me-3"></i></span><span>Product</span></a></li>
            <li><a href="./categories.html" class="" style="text-decoration: none; color: #8D98AF;"><i class="fa-solid fa-layer-group me-3"></i></span><span>Category</span></a></li>
            <li><a href="./customers.html" style="text-decoration: none; color: #8D98AF; "><i class="fa-solid fa-user me-3"></i>Customers</a></li>
            <li><a href="./distributor.html" style="text-decoration: none; color: #8D98AF; "><i class="fa-solid fa-user me-3"></i>Distributors</a></li>
            <li><a href="./" style="text-decoration: none; color: #8D98AF;"><i class="fa-solid fa-file-invoice me-3"></i></span><span>Reports</span></a></li>
            <li><a href="" style="text-decoration: none; color: #8D98AF;"><i class="fa-solid fa-receipt fa-beat me-3"></i></span><span>Coupon</span></a></li>
            <hr>
            <li><a href="" style="text-decoration: none; color: #8D98AF;"><i class="fa-solid fa-envelope me-3"></i></span><span>Inbox</span></a></li>
            <li><a href="#" style="text-decoration: none; color: #8D98AF; "><i class="fa-solid fa-gear me-3"></i>Settings</a></li>
            <li><a  onclick="logOut()" style="cursor:pointer; text-decoration: none; color: #8D98AF"><i class="fa-solid fa-arrow-right-from-bracket me-3"></i>Logout</a></li>
          </ul>
        </div>
      </div>


      <div class="container-fluid ">
        <div class="row">
          <!-- Sidebar -->
          <div class="col-md-2 sidebar d-lg-block d-none" >
          <ul class="listItem ">
                  <li">
                  <a href="./dashboard.html" class="active" style="text-decoration: none; color: #8D98AF; "><i class="fa-solid fa-house me-3"></i></span><span>Dashboard</span></a>
                  </li>
                  
                  <li>
                    <a href="./orders.html" class="" style="text-decoration: none; color: #8D98AF;"><i class="fa-solid fa-cart-shopping me-3"></i></span><span>Order</span></a>
                    </li>
                  <li>
                  <li>
                    <a href="./product.html" class="" style="text-decoration: none; color: #8D98AF;"><i class="fa-solid fa-cart-shopping me-3"></i></span><span>Product</span></a>
                    </li>
                  <li>
                  <li>
                    <a href="./categories.html" class="" style="text-decoration: none; color: #8D98AF;"><i class="fa-solid fa-layer-group me-3"></i></span><span>Category</span></a>
                    </li>
                  <li>
                  <a href="./customers.html" style="text-decoration: none; color:#8D98AF;"><i class="fa-solid fa-user me-3"></i></span><span>Customers</span></a>
                  </li>
                  <li>
                  <a href="./distributor.html" style="text-decoration: none; color:#8D98AF;"><i class="fa-solid fa-truck-fast me-2"></i></span><span>Distributors</span></a>
                  </li>
                  <li>
                      <a href="./inventory.html" style="text-decoration: none; color: #8D98AF;"><i class="fa-solid fa-file-invoice me-3"></i></span><span>Reports</span></a>
                  </li>
                  <li>
                      <a href="" style="text-decoration: none; color: #8D98AF;"><i class="fa-solid fa-receipt fa-beat me-3"></i></span><span>Coupon</span></a>
                  </li>
                  <hr>
                  <li class="">
                      <a href="" style="text-decoration: none; color: #8D98AF;"><i class="fa-solid fa-envelope me-3"></i></span><span>Inbox</span></a>
                  </li>
                  <li class="">
                      <a href="" style="text-decoration: none; color: #8D98AF;" ><i class="fa-solid fa-gear me-3"></i></span><span>settings</span></a>
                  </li>
                  

                  <button class="Dashbutton mt-5 " style="cursor: pointer; " onclick="logOut()">
                  <a  style="text-decoration: none; color:#8D98AF ;  "><i class="fa-solid fa-arrow-right-from-bracket me-3"></i></span><span class="logspan">Logout</span></a>
                  </button>
                  </li>
            </ul>
          </div>

          <!-- Main Content -->
            <div class="col-md-10 p-4">
                <div class="d-flex align-items-center justify-content-between">
                    <h4 class="fw-bold">Distributors</h4>

                    <!-- new add distributor -->
                     <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addDistributorModal">
                        Add Distributor
                    </button>

                    <div class="modal fade" id="addDistributorModal" tabindex="-1" aria-labelledby="addDistributorLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="addDistributorLabel">Add Distributor</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form id="addDistributorForm">
                            <div class="mb-3">
                                <label for="distName" class="form-label">Name</label>
                                <input type="text" class="form-control" id="distName" required>
                            </div>

                            <div class="mb-3">
                                <label for="distEmail" class="form-label">Email</label>
                                <input type="email" class="form-control" id="distEmail" required>
                            </div>

                            <div class="mb-3">
                                <label for="distPhone" class="form-label">Phone Number</label>
                                <input type="text" class="form-control" id="distPhone" required>
                            </div>

                            <div class="mb-3">
                                <label for="distPassword" class="form-label">Initial Password</label>
                                <input type="password" class="form-control" id="distPassword" required>
                            </div>

                            <div class="mb-3">
                                <label for="distConfirmPassword" class="form-label">Confirm Password</label>
                                <input type="password" class="form-control" id="distConfirmPassword" required>
                            </div>

                            <!-- Cascading dropdowns -->
                            <div class="mb-3">
                                <label class="form-label">Country</label>
                                <select class="form-select" id="distCountry" required>
                                <option value="">Select Country</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">State</label>
                                <select class="form-select" id="distState" required>
                                <option value="">Select State</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">City</label>
                                <select class="form-select" id="distCity" required>
                                <option value="">Select City</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label for="distRole" class="form-label">Role</label>
                                <select class="form-select" id="distRole" required>
                                <option value="distributor">Distributor</option>
                                </select>
                            </div>

                            <button type="submit" class="btn btn-primary">Add Distributor</button>
                            </form>
                        </div>
                        </div>
                    </div>
                    </div>

                </div>

                
                <div class="d-flex justify-content-between mt-3">
                <!-- Role Filter -->
                <div class="mb-3">
                    <label for="roleFilter" class="form-label">Filter by Role:</label>
                    <select id="roleFilter" class="form-select">
                    <option value="">All</option>
                    <option value="super_admin">Super Admin</option>
                    <option value="distributor">Distributor</option>
                    <option value="customer">Customer</option>
                    </select>
                </div>

                <!-- Search Input -->
                <div class="mb-3">
                    <label for="searchInput" class="form-label">Search:</label>
                    <input
                    type="text"
                    id="searchInput"
                    class="form-control"
                    placeholder="Search users..."
                    />
                </div>
                </div>

                <div class="table-responsive mt-4">
                <table class="table table-striped" id="usersTable">
                    <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone Number</th>
                        <th>Role</th>
                        <th>City</th>
                    </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <nav>
                    <ul class="pagination" id="pagination"></ul>
                </nav>
                </div>

            </div>
        </div>
      </div>

      

     
        <!-- nuw add dist function -->
         <script>
// ✅ Populate Country dropdown
async function loadCountries() {
  try {
    const res = await fetch("https://countriesnow.space/api/v0.1/countries/positions");
    const data = await res.json();

    const countryDropdown = document.getElementById("distCountry");
    data.data.forEach(c => {
      const opt = document.createElement("option");
      opt.value = c.name;
      opt.textContent = c.name;
      countryDropdown.appendChild(opt);
    });
  } catch (err) {
    console.error("Error loading countries:", err);
  }
}

// ✅ Load states when country is selected
document.getElementById("distCountry").addEventListener("change", async function() {
  const country = this.value;
  const stateDropdown = document.getElementById("distState");
  const cityDropdown = document.getElementById("distCity");

  stateDropdown.innerHTML = '<option value="">Select State</option>';
  cityDropdown.innerHTML = '<option value="">Select City</option>';

  if (!country) return;

  try {
    const res = await fetch("https://countriesnow.space/api/v0.1/countries/states", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ country })
    });
    const data = await res.json();

    if (data.data.states) {
      data.data.states.forEach(s => {
        const opt = document.createElement("option");
        opt.value = s.name;
        opt.textContent = s.name;
        stateDropdown.appendChild(opt);
      });
    }
  } catch (err) {
    console.error("Error loading states:", err);
  }
});

// ✅ Load cities when state is selected
document.getElementById("distState").addEventListener("change", async function() {
  const country = document.getElementById("distCountry").value;
  const state = this.value;
  const cityDropdown = document.getElementById("distCity");

  cityDropdown.innerHTML = '<option value="">Select City</option>';

  if (!country || !state) return;

  try {
    const res = await fetch("https://countriesnow.space/api/v0.1/countries/state/cities", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ country, state })
    });
    const data = await res.json();

    if (data.data) {
      data.data.forEach(city => {
        const opt = document.createElement("option");
        opt.value = city;
        opt.textContent = city;
        cityDropdown.appendChild(opt);
      });
    }
  } catch (err) {
    console.error("Error loading cities:", err);
  }
});

// ✅ Handle form submission
document.getElementById("addDistributorForm").addEventListener("submit", async function(e) {
  e.preventDefault();

  const distributor = {
    name: document.getElementById("distName").value,
    email: document.getElementById("distEmail").value,
    phoneNumber: document.getElementById("distPhone").value,
    password: document.getElementById("distPassword").value,
    confirmPassword: document.getElementById("distConfirmPassword").value,
    role: "distributor",
    country: document.getElementById("distCountry").value,
    state: document.getElementById("distState").value,
    city: document.getElementById("distCity").value
  };

  try {
    const res = await fetch("http://localhost:3001/amazon/document/api/register/create-distributor", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${localStorage.getItem("key")}`
        },
      body: JSON.stringify(distributor)
    });

    if (!res.ok) throw new Error(await res.text());
    alert("Distributor added successfully!");
    location.reload();
  } catch (err) {
    console.error("Error adding distributor:", err);
    alert("Error: " + err.message);
  }
});

// Load countries on modal open
document.getElementById("addDistributorModal").addEventListener("show.bs.modal", loadCountries);
        </script>
    
        <!-- show all users function  -->
        <script>
document.addEventListener("DOMContentLoaded", () => {
  const usersTableBody = document.querySelector("#usersTable tbody");
  const token = localStorage.getItem("key");

  let users = [];
  let currentPage = 1;
  const rowsPerPage = 10;

  const searchInput = document.getElementById("searchInput");
  const roleFilter = document.getElementById("roleFilter");

  // Fetch all users
  async function loadUsers() {
    try {
      const res = await fetch("http://localhost:3001/amazon/document/api/register/all-users", {
        headers: { Authorization: `Bearer ${token}` },
      });
      if (!res.ok) throw new Error("Failed to fetch users");
      users = await res.json();
      currentPage = 1;
      renderTable();
      renderPagination();
    } catch (err) {
      console.error("Error loading users:", err);
    }
  }

  // Render table rows
  function renderTable() {
    const searchTerm = searchInput.value.toLowerCase();
    const selectedRole = roleFilter.value;

    const filtered = users.filter(u => {
      const matchesRole = selectedRole ? u.role === selectedRole : true;
      const matchesSearch =
        u.name.toLowerCase().includes(searchTerm) ||
        u.email.toLowerCase().includes(searchTerm) ||
        u.phoneNumber.includes(searchTerm) ||
        (u.city && u.city.toLowerCase().includes(searchTerm));
      return matchesRole && matchesSearch;
    });

    const start = (currentPage - 1) * rowsPerPage;
    const paginated = filtered.slice(start, start + rowsPerPage);

    usersTableBody.innerHTML = "";
    paginated.forEach(u => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${u.name}</td>
        <td>${u.email}</td>
        <td>${u.phoneNumber}</td>
        <td>${u.role}</td>
        <td>${u.city || ""}</td>
      `;
      usersTableBody.appendChild(tr);
    });
  }

  // Render pagination
  function renderPagination() {
    const paginationContainer = document.getElementById("pagination");
    if (!paginationContainer) return;

    const searchTerm = searchInput.value.toLowerCase();
    const selectedRole = roleFilter.value;

    const filtered = users.filter(u => {
      const matchesRole = selectedRole ? u.role === selectedRole : true;
      const matchesSearch =
        u.name.toLowerCase().includes(searchTerm) ||
        u.email.toLowerCase().includes(searchTerm) ||
        u.phoneNumber.includes(searchTerm) ||
        (u.city && u.city.toLowerCase().includes(searchTerm));
      return matchesRole && matchesSearch;
    });

    const pageCount = Math.ceil(filtered.length / rowsPerPage);
    paginationContainer.innerHTML = "";

    for (let i = 1; i <= pageCount; i++) {
      const btn = document.createElement("button");
      btn.textContent = i;
      btn.classList.add("btn", "btn-sm", "me-1");
      btn.classList.add(i === currentPage ? "btn-primary" : "btn-outline-primary");
      btn.addEventListener("click", () => {
        currentPage = i;
        renderTable();
        renderPagination();
      });
      paginationContainer.appendChild(btn);
    }
  }

  // Event listeners
  searchInput.addEventListener("input", () => {
    currentPage = 1;
    renderTable();
    renderPagination();
  });

  roleFilter.addEventListener("change", () => {
    currentPage = 1;
    renderTable();
    renderPagination();
  });

  // Initial load
  loadUsers();
});
        </script>





    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/js/all.min.js" integrity="sha512-b+nQTCdtTBIRIbraqNEwsjB6UvL3UEMkXnhzd8awtCYh0Kcsjl9uEgwVFVbhoj3uu1DO1ZMacNvLoyJJiNfcvg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
      <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
      <script src="./js/index.js"></script>
</body>
</body>
</html>