<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Super Admin - Products</title>
  
  <!-- Bootstrap 5.3.6 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-light">

<div class="container mt-5">
  <h2 class="mb-4 text-center">ðŸ“¦ Product Management (Super Admin)</h2>

  <!-- Spinner -->
  <div id="loadingSpinner" class="text-center my-3" style="display:none;">
    <div class="spinner-border text-primary" role="status"></div>
    <p>Loading products...</p>
  </div>

  <!-- Search + Page Size -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <input type="text" id="searchInput" class="form-control w-50" placeholder="Search products...">
    <select id="pageSize" class="form-select w-auto ms-2">
      <option value="5">5 per page</option>
      <option value="10" selected>10 per page</option>
      <option value="20">20 per page</option>
      <option value="50">50 per page</option>
    </select>
  </div>

  <!-- Table -->
  <div class="table-responsive">
    <table class="table table-striped table-hover align-middle">
      <thead class="table-dark">
        <tr>
          <th>Name</th>
          <th>Image</th>
          <th>Description</th>
          <th>Price</th>
          <th>Stock</th>
          <th>Category</th>
          <th>Variety</th>
          <th>Benefits</th>
          <th>Ingredients</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="productsTableBody">
        <!-- Rows dynamically inserted -->
      </tbody>
    </table>
  </div>

  <!-- Update Modal -->
<div class="modal fade" id="updateModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form id="updateForm">
        <div class="modal-header">
          <h5 class="modal-title">Update Product</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body row g-3">
          <input type="hidden" id="updateProductId">

          <div class="col-md-6">
            <label class="form-label">Name</label>
            <input type="text" id="updateName" class="form-control" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">Price</label>
            <input type="number" id="updatePrice" class="form-control" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">Stock</label>
            <input type="number" id="updateStock" class="form-control" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">Category</label>
            <input type="text" id="updateCategory" class="form-control" required>
          </div>
          <div class="col-12">
            <label class="form-label">Description</label>
            <textarea id="updateDescription" class="form-control" rows="2" required></textarea>
          </div>
          <div class="col-12">
            <label class="form-label">Images (comma separated)</label>
            <input type="text" id="updateImages" class="form-control">
          </div>
          <div class="col-12">
            <label class="form-label">Variety (comma separated)</label>
            <input type="text" id="updateVariety" class="form-control">
          </div>
          <div class="col-12">
            <label class="form-label">Benefits</label>
            <textarea id="updateBenefits" class="form-control" rows="2"></textarea>
          </div>
          <div class="col-12">
            <label class="form-label">Ingredients (comma separated)</label>
            <input type="text" id="updateIngredients" class="form-control">
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">Save changes</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Delete Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title">Delete Product</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p id="deleteMessage">Are you sure you want to delete this product?</p>
        <input type="hidden" id="deleteProductId">
      </div>
      <div class="modal-footer">
        <button type="button" id="confirmDelete" class="btn btn-danger">Delete</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
      </div>
    </div>
  </div>
</div>

  <!-- Pagination -->
  <nav>
    <ul class="pagination justify-content-center" id="paginationControls"></ul>
  </nav>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const spinner = document.getElementById("loadingSpinner");
  const tableBody = document.getElementById("productsTableBody");
  const paginationControls = document.getElementById("paginationControls");
  const searchInput = document.getElementById("searchInput");
  const pageSizeSelect = document.getElementById("pageSize");

  let products = [];
  let filteredProducts = [];
  let currentPage = 1;
  let pageSize = parseInt(pageSizeSelect.value, 10);

  // Fetch products from backend
  async function fetchProducts() {
    const token = localStorage.getItem("key");
    if (!token) {
      Swal.fire({ icon: "error", text: "Unauthorized: No token found" });
      return;
    }

    spinner.style.display = "block";
    try {
      const res = await fetch("http://localhost:3001/amazon/document/api/products", {
        headers: { "Authorization": `Bearer ${token}` }
      });
      const data = await res.json();

      if (!Array.isArray(data)) throw new Error("Invalid response format");

      products = data;
      filteredProducts = [...products];
      renderTable();
    } catch (err) {
      console.error("Error fetching products:", err);
      Swal.fire({ icon: "error", text: "Failed to load products" });
    } finally {
      spinner.style.display = "none";
    }
  }

  // Render table rows with pagination
  function renderTable() {
    tableBody.innerHTML = "";

    const start = (currentPage - 1) * pageSize;
    const end = start + pageSize;
    const paginatedProducts = filteredProducts.slice(start, end);

    paginatedProducts.forEach(prod => {
      const row = document.createElement("tr");

      row.innerHTML = `
        <td>${prod.name}</td>
        <td><img src="${prod.image?.[0] || ''}" alt="Product" class="img-thumbnail" style="width:50px;height:50px;"></td>
        <td>${prod.description}</td>
        <td>$${prod.price}</td>
        <td>${prod.numberInStock}</td>
        <td>${prod.category?.name || ''}</td>
        <td>${prod.variety.map(v => `<span class="badge bg-info me-1">${v}</span>`).join("")}</td>
        <td>${prod.benefits}</td>
        <td>${prod.ingredients.map(i => `<span class="badge bg-secondary me-1">${i}</span>`).join("")}</td>
        <td>
          <button class="btn btn-sm btn-warning me-1 update-btn" data-id="${prod._id}">Update</button>
          <button class="btn btn-sm btn-danger delete-btn" data-id="${prod._id}">Delete</button>
        </td>
      `;
      tableBody.appendChild(row);
    });

    renderPagination();
  }

  // Render pagination controls
  function renderPagination() {
    paginationControls.innerHTML = "";
    const totalPages = Math.ceil(filteredProducts.length / pageSize);

    for (let i = 1; i <= totalPages; i++) {
      const li = document.createElement("li");
      li.className = `page-item ${i === currentPage ? "active" : ""}`;
      li.innerHTML = `<a class="page-link" href="#">${i}</a>`;
      li.addEventListener("click", (e) => {
        e.preventDefault();
        currentPage = i;
        renderTable();
      });
      paginationControls.appendChild(li);
    }
  }

  // Search filter
  searchInput.addEventListener("input", () => {
    const query = searchInput.value.toLowerCase();
    filteredProducts = products.filter(p =>
      p.name.toLowerCase().includes(query) ||
      p.description.toLowerCase().includes(query)
    );
    currentPage = 1;
    renderTable();
  });

  // Page size change
  pageSizeSelect.addEventListener("change", () => {
    pageSize = parseInt(pageSizeSelect.value, 10);
    currentPage = 1;
    renderTable();
  });

  // Initial load
  fetchProducts();
});
</script>








 

<script src="js/index.js"></script>
</body>
</html>
